# –ü–ª–∞–Ω –º–∏–≥—Ä–∞—Ü–∏–∏: –û—Ç –∂–µ—Å—Ç–∫–æ–π –ø—Ä–∏–≤—è–∑–∫–∏ –∫ –±–∞–Ω–∫—É –≤–æ–ø—Ä–æ—Å–æ–≤

## –û–±–∑–æ—Ä –∏–∑–º–µ–Ω–µ–Ω–∏–π

### üéØ –¶–µ–ª—å –º–∏–≥—Ä–∞—Ü–∏–∏
–ü–µ—Ä–µ—Ö–æ–¥ –æ—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã "–æ–¥–∏–Ω –≤–æ–ø—Ä–æ—Å = –æ–¥–∏–Ω —Ç–µ—Å—Ç" –∫ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ "–±–∞–Ω–∫ –≤–æ–ø—Ä–æ—Å–æ–≤ —Ç–µ–º—ã + –≥–∏–±–∫–æ–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –≤ —Ç–µ—Å—Ç—ã".

### üìä –ú–∞—Å—à—Ç–∞–± –∏–∑–º–µ–Ω–µ–Ω–∏–π (—É–ø—Ä–æ—â–µ–Ω–Ω—ã–π)
- **–ú–æ–¥–µ–ª–∏ –ë–î:** 1 –Ω–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Å–≤—è–∑–µ–π, –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª–µ–π –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é
- **–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏:** 2-3 –º–æ–¥—É–ª—è —Ç—Ä–µ–±—É—é—Ç —Ç–æ—á–µ—á–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
- **–°–µ—Ä–≤–∏—Å—ã:** 2 —Å–µ—Ä–≤–∏—Å–∞ —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏
- **API:** 5-7 –Ω–æ–≤—ã—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ 3-4 —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö
- **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:** –ë–∞–∑–æ–≤—ã–µ unit —Ç–µ—Å—Ç—ã –¥–ª—è –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π

### ‚úÖ –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏
- **–ù–µ—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö** - —Å–≤–µ–∂–∏–π –ø—Ä–æ–µ–∫—Ç –±–µ–∑ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
- **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ** - –≤–æ–ø—Ä–æ—Å—ã –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ —Ç–µ—Å—Ç–∞
- **–¢–æ—á–µ—á–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è** - –∫–æ—Å–º–µ—Ç–∏—á–µ—Å–∫–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –ª–æ–≥–∏–∫–∏
- **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** - –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥ –±–µ–∑ breaking changes

### üî• –í–∞–∂–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- **–ò—Ç–æ–≥–æ–≤—ã–π —Ç–µ—Å—Ç —Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ç–µ–º—ã
- **–ù–∏–∫–∞–∫–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ù–ï –º–æ–≥—É—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å** –∏—Ç–æ–≥–æ–≤—ã–µ —Ç–µ—Å—Ç—ã –≤—Ä—É—á–Ω—É—é
- **–õ–æ–≥–∏–∫–∞ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –≤–æ–ø—Ä–æ—Å–æ–≤** –ª–µ–∂–∏—Ç –≤ Python –∫–æ–¥–µ, –Ω–µ –≤ –ë–î
- **question_selection_config –ù–ï –Ω—É–∂–µ–Ω** - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ hardcoded –≤ –∫–æ–¥–µ
- **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ** —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ —Ç–µ—Å—Ç–∞ —Å—Ç—É–¥–µ–Ω—Ç–æ–º

---

## 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –º–∏–≥—Ä–∞—Ü–∏–∏

### 1.1 –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

#### –¢–µ–∫—É—â–∏–µ –º–æ–¥–µ–ª–∏ –∏ —Å–≤—è–∑–∏:
```python
# –¢–µ–∫—É—â–∞—è –º–æ–¥–µ–ª—å Question
class Question(Base):
    __tablename__ = "questions"
    id = Column(Integer, primary_key=True)
    test_id = Column(Integer, ForeignKey("tests.id"), nullable=False)  # ‚ùå –ñ–µ—Å—Ç–∫–∞—è –ø—Ä–∏–≤—è–∑–∫–∞
    question = Column(String, nullable=False)
    question_type = Column(Enum(QuestionType), nullable=False)
    # ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è

    test = relationship("Test", back_populates="questions")  # ‚ùå –û–¥–∏–Ω-–∫-–æ–¥–Ω–æ–º—É

# –¢–µ–∫—É—â–∞—è –º–æ–¥–µ–ª—å Test
class Test(Base):
    questions = relationship("Question", back_populates="test", cascade="all, delete-orphan")
```

#### –¢–µ–∫—É—â–∏–µ API –ø–∞—Ç—Ç–µ—Ä–Ω—ã:
```
GET    /api/v1/questions/?test_id={test_id}          # –í–æ–ø—Ä–æ—Å—ã –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞
POST   /api/v1/questions/?test_id={test_id}          # –°–æ–∑–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å –≤ —Ç–µ—Å—Ç–µ
PUT    /api/v1/questions/{question_id}               # –û–±–Ω–æ–≤–∏—Ç—å –≤–æ–ø—Ä–æ—Å
DELETE /api/v1/questions/{question_id}               # –£–¥–∞–ª–∏—Ç—å –≤–æ–ø—Ä–æ—Å
```

#### –¢–µ–∫—É—â–∏–µ —Å–µ—Ä–≤–∏—Å—ã:
- `QuestionService.create_question(test_id, ...)` - –ø—Ä–∏–≤—è–∑–∫–∞ –∫ —Ç–µ—Å—Ç—É –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏
- `QuestionService.list_questions(test_id)` - —Ñ–∏–ª—å—Ç—Ä –ø–æ —Ç–µ—Å—Ç—É
- `TestService` - —Ä–∞–±–æ—Ç–∞–µ—Ç —Å questions —á–µ—Ä–µ–∑ relationship

### 1.2 –†–∏—Å–∫–∏ –∏ mitigation

#### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ä–∏—Å–∫–∏:
1. **–ü–æ—Ç–µ—Ä—è –¥–∞–Ω–Ω—ã—Ö** - –æ—à–∏–±–∫–∏ –≤ –º–∏–≥—Ä–∞—Ü–∏–∏ test_id ‚Üí topic_id
2. **–ù–∞—Ä—É—à–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã** - —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–µ—Å—Ç—ã –ø–µ—Ä–µ—Å—Ç–∞–Ω—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å
3. **API —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** - —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –º–æ–∂–µ—Ç —Å–ª–æ–º–∞—Ç—å—Å—è
4. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** - –Ω–æ–≤—ã–µ JOIN –∑–∞–ø—Ä–æ—Å—ã –º–æ–≥—É—Ç –±—ã—Ç—å –º–µ–¥–ª–µ–Ω–Ω–µ–µ

#### Mitigation —Å—Ç—Ä–∞—Ç–µ–≥–∏—è:
- –ü–æ–ª–Ω—ã–π backup –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ –º–∏–≥—Ä–∞—Ü–∏–µ–π
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ staging —Å—Ä–µ–¥–µ
- Feature flags –¥–ª—è –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–≥–æ rollout
- Rollback –ø–ª–∞–Ω —Å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ–º –∏–∑ backup

---

## 2. –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

### 2.1 –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä

#### –®–∞–≥ 2.1.1: –ù–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞ test_questions
```sql
-- –¢–∞–±–ª–∏—Ü–∞ —Å–≤—è–∑–µ–π –¥–ª—è many-to-many –æ—Ç–Ω–æ—à–µ–Ω–∏–π —Ç–µ—Å—Ç-–≤–æ–ø—Ä–æ—Å
CREATE TABLE test_questions (
    test_id INTEGER NOT NULL,
    question_id INTEGER NOT NULL,
    added_by INTEGER NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

    PRIMARY KEY (test_id, question_id),

    FOREIGN KEY (test_id) REFERENCES tests(id) ON DELETE CASCADE,
    FOREIGN KEY (question_id) REFERENCES questions(id) ON DELETE CASCADE,
    FOREIGN KEY (added_by) REFERENCES users(id)
);

-- –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
CREATE INDEX idx_test_questions_test_id ON test_questions(test_id);
CREATE INDEX idx_test_questions_question_id ON test_questions(question_id);
```

#### –®–∞–≥ 2.1.2: –ù–æ–≤—ã–µ –ø–æ–ª—è –≤ —Ç–∞–±–ª–∏—Ü–µ questions
```sql
-- –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã questions –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –±–∞–Ω–∫–∞ –≤–æ–ø—Ä–æ—Å–æ–≤
ALTER TABLE questions ADD COLUMN topic_id INTEGER;
ALTER TABLE questions ADD COLUMN section_id INTEGER;
ALTER TABLE questions ADD COLUMN created_by INTEGER;
ALTER TABLE questions ADD COLUMN is_final BOOLEAN DEFAULT FALSE;

-- –í–Ω–µ—à–Ω–∏–µ –∫–ª—é—á–∏
ALTER TABLE questions ADD CONSTRAINT fk_questions_topic_id
    FOREIGN KEY (topic_id) REFERENCES topics(id);
ALTER TABLE questions ADD CONSTRAINT fk_questions_section_id
    FOREIGN KEY (section_id) REFERENCES sections(id);
ALTER TABLE questions ADD CONSTRAINT fk_questions_created_by
    FOREIGN KEY (created_by) REFERENCES users(id);

-- –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤
CREATE INDEX idx_questions_topic_id ON questions(topic_id);
CREATE INDEX idx_questions_section_id ON questions(section_id);
CREATE INDEX idx_questions_created_by ON questions(created_by);
CREATE INDEX idx_questions_is_final ON questions(is_final);
```

#### –®–∞–≥ 2.1.3: –ò—Ç–æ–≥–æ–≤—ã–µ —Ç–µ—Å—Ç—ã —Å–æ–∑–¥–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
```python
# –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ç–µ–º—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç—Å—è –∏—Ç–æ–≥–æ–≤—ã–π —Ç–µ—Å—Ç
# –õ–æ–≥–∏–∫–∞ –≤ src/service/topics.py –∏–ª–∏ src/service/tests.py
# –ù–∏–∫–∞–∫–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –º–æ–≥—É—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –∏—Ç–æ–≥–æ–≤—ã–µ —Ç–µ—Å—Ç—ã –≤—Ä—É—á–Ω—É—é
```

### 2.2 –ú–∏–≥—Ä–∞—Ü–∏—è –º–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö

#### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ SQLAlchemy –º–æ–¥–µ–ª–∏:
```python
# src/domain/models.py
class Question(Base):
    __tablename__ = "questions"

    # –£–±—Ä–∞—Ç—å test_id, –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ –ø–æ–ª—è
    topic_id = Column(Integer, ForeignKey("topics.id"), nullable=True, index=True)  # ‚úÖ
    section_id = Column(Integer, ForeignKey("sections.id"), nullable=True, index=True)  # ‚úÖ
    created_by = Column(Integer, ForeignKey("users.id"), nullable=True, index=True)  # ‚úÖ
    is_final = Column(Boolean, default=False)  # ‚úÖ

    # –°–≤—è–∑–∏
    topic = relationship("Topic", back_populates="questions")
    section = relationship("Section", back_populates="questions")
    creator = relationship("User", foreign_keys=[created_by])

# –ù–æ–≤–∞—è –º–æ–¥–µ–ª—å –¥–ª—è —Å–≤—è–∑–µ–π
class TestQuestion(Base):
    __tablename__ = "test_questions"

    test_id = Column(Integer, ForeignKey("tests.id"), primary_key=True)
    question_id = Column(Integer, ForeignKey("questions.id"), primary_key=True)
    added_by = Column(Integer, ForeignKey("users.id"), nullable=False)
    created_at = Column(DateTime, default=datetime.now)

    # –°–≤—è–∑–∏
    test = relationship("Test", back_populates="question_links")
    question = relationship("Question", back_populates="test_links")
    adder = relationship("User", foreign_keys=[added_by])
```

### 2.3 –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π

#### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π:
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
alembic upgrade head

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–∞–∑–æ–≤—ã–µ —Ç–µ—Å—Ç—ã
pytest tests/ -v
```

---

## 3. –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è—Ö

### 3.1 –ù–æ–≤—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π test_questions

#### –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–∞: `src/repository/test_questions.py`
```python
# src/repository/test_questions.py
"""
–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–≤—è–∑—è–º–∏ —Ç–µ—Å—Ç-–≤–æ–ø—Ä–æ—Å (many-to-many)
"""
from typing import List
from sqlalchemy.ext.asyncio import AsyncSession
from sqlalchemy import select, delete

from src.domain.models import TestQuestion
from src.repository.base import create_item

async def add_question_to_test(
    session: AsyncSession,
    test_id: int,
    question_id: int,
    added_by: int
) -> TestQuestion:
    """–î–æ–±–∞–≤–∏—Ç—å –≤–æ–ø—Ä–æ—Å –≤ —Ç–µ—Å—Ç"""
    return await create_item(
        session,
        TestQuestion,
        test_id=test_id,
        question_id=question_id,
        added_by=added_by
    )

async def remove_question_from_test(
    session: AsyncSession,
    test_id: int,
    question_id: int
) -> bool:
    """–£–¥–∞–ª–∏—Ç—å –≤–æ–ø—Ä–æ—Å –∏–∑ —Ç–µ—Å—Ç–∞"""
    stmt = delete(TestQuestion).where(
        TestQuestion.test_id == test_id,
        TestQuestion.question_id == question_id
    )
    result = await session.execute(stmt)
    return result.rowcount > 0

async def get_test_questions(session: AsyncSession, test_id: int) -> List[TestQuestion]:
    """–ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ —Å–≤—è–∑–∏ –≤–æ–ø—Ä–æ—Å–æ–≤ —Å —Ç–µ—Å—Ç–æ–º"""
    stmt = select(TestQuestion).where(TestQuestion.test_id == test_id)
    result = await session.execute(stmt)
    return list(result.scalars().all())

async def get_question_usage(session: AsyncSession, question_id: int) -> List[TestQuestion]:
    """–í –∫–∞–∫–∏—Ö —Ç–µ—Å—Ç–∞—Ö –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–æ–ø—Ä–æ—Å"""
    stmt = select(TestQuestion).where(TestQuestion.question_id == question_id)
    result = await session.execute(stmt)
    return list(result.scalars().all())
```

### 3.2 –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è questions

#### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –º–µ—Ç–æ–¥–æ–≤ –≤ `src/repository/questions/crud.py`:
```python
async def list_questions_by_topic(
    session: AsyncSession,
    topic_id: int,
    include_archived: bool = False,
    is_final: Optional[bool] = None
) -> List[Question]:
    """–ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –≤–æ–ø—Ä–æ—Å—ã —Ç–µ–º—ã (–±–∞–Ω–∫ –≤–æ–ø—Ä–æ—Å–æ–≤)"""
    stmt = select(Question).where(Question.topic_id == topic_id)

    if not include_archived:
        stmt = stmt.where(Question.is_archived == False)

    if is_final is not None:
        stmt = stmt.where(Question.is_final == is_final)

    stmt = stmt.order_by(Question.updated_at.desc())

    result = await session.execute(stmt)
    return list(result.scalars().all())

async def list_questions_by_test(test_id: int) -> List[Question]:
    """–ü–æ–ª—É—á–∏—Ç—å –≤–æ–ø—Ä–æ—Å—ã —Ç–µ—Å—Ç–∞ —á–µ—Ä–µ–∑ JOIN —Å test_questions"""
    stmt = (
        select(Question)
        .join(TestQuestion, Question.id == TestQuestion.question_id)
        .where(TestQuestion.test_id == test_id)
        .order_by(Question.updated_at.desc())
    )

    result = await session.execute(stmt)
    return list(result.scalars().all())
```

### 3.3 –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º –∫–æ–¥–µ

#### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `create_question` (–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤):
```python
async def create_question(
    session: AsyncSession,
    topic_id: int,        # ‚úÖ –ù–æ–≤—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä
    section_id: Optional[int],  # ‚úÖ –ù–æ–≤—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä
    created_by: int,      # ‚úÖ –ù–æ–≤—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä
    is_final: bool = False,     # ‚úÖ –ù–æ–≤—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä
    question: str,
    question_type: str,
    # ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
) -> Question:
    # –°—É—â–µ—Å—Ç–≤—É—é—â–∞—è –ª–æ–≥–∏–∫–∞ —Å –Ω–æ–≤—ã–º–∏ –ø–æ–ª—è–º–∏
    pass
```

---

## 4. –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Å–µ—Ä–≤–∏—Å–∞—Ö

### 4.0 –õ–æ–≥–∏–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è –∏—Ç–æ–≥–æ–≤–æ–≥–æ —Ç–µ—Å—Ç–∞

#### –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ç–µ–º—ã (–≤ TopicService):
```python
# src/service/topics.py
class TopicService:
    @staticmethod
    async def create_topic(
        session: AsyncSession,
        title: str,
        description: str,
        creator_id: int,
        # ... –¥—Ä—É–≥–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
    ) -> Topic:
        # –°–æ–∑–¥–∞—Ç—å —Ç–µ–º—É
        topic = Topic(
            title=title,
            description=description,
            creator_id=creator_id,
            # ...
        )
        session.add(topic)
        await session.commit()
        await session.refresh(topic)

        # üî• –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò –°–û–ó–î–ê–¢–¨ –ò–¢–û–ì–û–í–´–ô –¢–ï–°–¢
        # –ù–∏–∫–∞–∫–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –º–æ–≥—É—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –∏—Ç–æ–≥–æ–≤—ã–µ —Ç–µ—Å—Ç—ã!
        # –°–∏—Å—Ç–µ–º–∞ —Å–æ–∑–¥–∞–µ—Ç —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ç–µ–º—ã
        await TestService.create_final_test_for_topic(
            session=session,
            topic_id=topic.id,
            creator_id=creator_id
        )

        return topic
```

#### –ó–∞—â–∏—Ç–∞ –æ—Ç —Å–æ–∑–¥–∞–Ω–∏—è –∏—Ç–æ–≥–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏:
```python
# –í API –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–µ—Å—Ç–æ–≤ –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É
@router.post("/topics/{topic_id}/tests")
async def create_test_in_topic(
    topic_id: int,
    data: TestCreateSchema,
    current_user=Depends(require_roles(Role.ADMIN, Role.TEACHER))
):
    # –ó–ê–ü–†–ï–¢–ò–¢–¨ —Å–æ–∑–¥–∞–Ω–∏–µ –∏—Ç–æ–≥–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
    if data.is_final or data.type == TestType.GLOBAL_FINAL:
        raise HTTPException(
            status_code=403,
            detail="–ò—Ç–æ–≥–æ–≤—ã–µ —Ç–µ—Å—Ç—ã —Å–æ–∑–¥–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∏—Å—Ç–µ–º–æ–π"
        )

    # –°–æ–∑–¥–∞–Ω–∏–µ –æ–±—ã—á–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ —Ä–∞–∑—Ä–µ—à–µ–Ω–æ
    return await TestService.create_test_in_topic(...)
```

### 4.1 –ù–æ–≤—ã–π —Å–µ—Ä–≤–∏—Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–≤—è–∑—è–º–∏

#### –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–∞: `src/service/test_questions_service.py`
```python
# src/service/test_questions_service.py
class TestQuestionsService:
    """–°–µ—Ä–≤–∏—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–≤—è–∑—è–º–∏ —Ç–µ—Å—Ç-–≤–æ–ø—Ä–æ—Å"""

    @staticmethod
    async def add_questions_to_test(
        session: AsyncSession,
        test_id: int,
        question_ids: List[int],
        current_user_id: int
    ) -> List[TestQuestion]:
        """–î–æ–±–∞–≤–∏—Ç—å –≤–æ–ø—Ä–æ—Å—ã –≤ —Ç–µ—Å—Ç"""
        # –ü–æ–ª—É—á–∏—Ç—å —Ç–µ—Å—Ç –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞
        test = await get_test_by_id(session, test_id)
        await ensure_can_access_topic(session, test.topic_id, current_user_id)

        # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –≤–æ–ø—Ä–æ—Å—ã –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∞—Ç —Ç–æ–π –∂–µ —Ç–µ–º–µ
        for question_id in question_ids:
            question = await get_question(session, question_id)
            if question.topic_id != test.topic_id:
                raise ValidationError("–í–æ–ø—Ä–æ—Å –¥–æ–ª–∂–µ–Ω –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∞—Ç—å —Ç–µ–º–µ —Ç–µ—Å—Ç–∞")

        # –°–æ–∑–¥–∞—Ç—å —Å–≤—è–∑–∏
        links = []
        for question_id in question_ids:
            link = await add_question_to_test(
                session,
                test_id,
                question_id,
                current_user_id
            )
            links.append(link)

        return links

    @staticmethod
    async def remove_question_from_test(
        session: AsyncSession,
        test_id: int,
        question_id: int,
        current_user_id: int
    ) -> bool:
        """–£–¥–∞–ª–∏—Ç—å –≤–æ–ø—Ä–æ—Å –∏–∑ —Ç–µ—Å—Ç–∞"""
        test = await get_test_by_id(session, test_id)
        await ensure_can_access_topic(session, test.topic_id, current_user_id)

        return await remove_question_from_test(session, test_id, question_id)
```

### 4.2 –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ QuestionService

#### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–µ—Ç–æ–¥–æ–≤ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ç–µ–º–∞–º–∏:
```python
# src/service/questions.py
class QuestionService:
    @staticmethod
    async def create_question_in_topic(
        session: AsyncSession,
        topic_id: int,
        section_id: Optional[int],
        current_user_id: int,
        question: str,
        question_type: str,
        # ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
    ) -> Question:
        """–°–æ–∑–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å –≤ —Ç–µ–º–µ (–±–∞–Ω–∫ –≤–æ–ø—Ä–æ—Å–æ–≤)"""
        await ensure_can_access_topic(session, topic_id, current_user_id)

        return await repo_create_question(
            session,
            topic_id=topic_id,
            section_id=section_id,
            created_by=current_user_id,
            question=question,
            question_type=question_type,
            # ...
        )

    @staticmethod
    async def get_topic_questions(
        session: AsyncSession,
        topic_id: int,
        current_user_id: int,
        is_final: Optional[bool] = None
    ) -> List[Question]:
        """–ü–æ–ª—É—á–∏—Ç—å –≤–æ–ø—Ä–æ—Å—ã —Ç–µ–º—ã (–±–∞–Ω–∫ –≤–æ–ø—Ä–æ—Å–æ–≤)"""
        await ensure_can_access_topic(session, topic_id, current_user_id)

        return await repo_list_questions_by_topic(
            session,
            topic_id,
            is_final=is_final
        )
```

### 4.3 –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ TestService

#### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è:
```python
# src/service/tests.py
class TestService:
    @staticmethod
    async def create_final_test_for_topic(
        session: AsyncSession,
        topic_id: int,
        creator_id: int
    ) -> Test:
        """–°–æ–∑–¥–∞—Ç—å –∏—Ç–æ–≥–æ–≤—ã–π —Ç–µ—Å—Ç –¥–ª—è —Ç–µ–º—ã (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ç–µ–º—ã)"""
        # –°–∏—Å—Ç–µ–º–∞ —Å–æ–∑–¥–∞–µ—Ç –∏—Ç–æ–≥–æ–≤—ã–π —Ç–µ—Å—Ç - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –º–æ–≥—É—Ç
        final_test = Test(
            topic_id=topic_id,
            title="–ò—Ç–æ–≥–æ–≤—ã–π —Ç–µ—Å—Ç",
            description="–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∏—Ç–æ–≥–æ–≤—ã–π —Ç–µ—Å—Ç —Ç–µ–º—ã",
            type=TestType.GLOBAL_FINAL,
            is_final=True,
            duration=60,  # –ú–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å
            completion_percentage=80.0
        )
        session.add(final_test)
        await session.commit()
        return final_test

    @staticmethod
    async def get_test_questions_for_student(
        session: AsyncSession,
        test_id: int,
        student_id: int
    ) -> List[Question]:
        """
        –ü–æ–ª—É—á–∏—Ç—å –≤–æ–ø—Ä–æ—Å—ã –¥–ª—è —Ç–µ—Å—Ç–∞ (–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ).

        –î–ª—è –∏—Ç–æ–≥–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤:
        - –õ–æ–≥–∏–∫–∞ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –≤–æ–ø—Ä–æ—Å–æ–≤ –ª–µ–∂–∏—Ç –≤ Python –∫–æ–¥–µ
        - –ö–∞–∂–¥—ã–π —Å—Ç—É–¥–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç —Ä–∞–∑–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã
        - –§–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ —Ç–µ—Å—Ç–∞
        - –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –ë–î, –∞ hardcoded –≤ –∫–æ–¥–µ
        """
        test = await get_test_by_id(session, test_id)

        if test.type == TestType.GLOBAL_FINAL:
            # –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –∏—Ç–æ–≥–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤
            # –õ–æ–≥–∏–∫–∞: –≤—ã–±—Ä–∞—Ç—å is_final –≤–æ–ø—Ä–æ—Å—ã –∏–∑ –±–∞–Ω–∫–∞ —Ç–µ–º—ã
            # TODO: —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–ª–æ–∂–Ω—É—é –ª–æ–≥–∏–∫—É —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–æ —Ä–∞–∑–¥–µ–ª–∞–º
            return await QuestionBankService.select_final_questions_for_test(
                session,
                test.topic_id,
                10,  # hardcoded –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ–ø—Ä–æ—Å–æ–≤, –º–æ–∂–Ω–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞—Ç—å
                student_id
            )
        else:
            # –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –≤–æ–ø—Ä–æ—Å—ã –∏–∑ —Å–≤—è–∑–µ–π (–¥–ª—è –æ–±—ã—á–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤)
            return await repo_list_questions_by_test(session, test_id)
```

---

## 5. –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ API

### 5.1 –ù–æ–≤—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

#### API –±–∞–Ω–∫–∞ –≤–æ–ø—Ä–æ—Å–æ–≤:
```
# –ü–æ–ª—É—á–∏—Ç—å –≤–æ–ø—Ä–æ—Å—ã —Ç–µ–º—ã (–±–∞–Ω–∫ –≤–æ–ø—Ä–æ—Å–æ–≤)
GET    /api/v1/topics/{topic_id}/questions

# –°–æ–∑–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å –≤ —Ç–µ–º–µ
POST   /api/v1/topics/{topic_id}/questions

# –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–æ–ø—Ä–æ—Å–∞–º–∏ –≤ —Ç–µ—Å—Ç–∞—Ö
POST   /api/v1/tests/{test_id}/questions          # –î–æ–±–∞–≤–∏—Ç—å –≤–æ–ø—Ä–æ—Å—ã –≤ —Ç–µ—Å—Ç
DELETE /api/v1/tests/{test_id}/questions          # –£–¥–∞–ª–∏—Ç—å –≤–æ–ø—Ä–æ—Å—ã –∏–∑ —Ç–µ—Å—Ç–∞
GET    /api/v1/tests/{test_id}/questions          # –ü–æ–ª—É—á–∏—Ç—å –≤–æ–ø—Ä–æ—Å—ã —Ç–µ—Å—Ç–∞
```

#### –°—Ö–µ–º—ã –¥–∞–Ω–Ω—ã—Ö:
```python
# src/api/v1/questions/schemas.py
class QuestionCreateInTopicSchema(BaseModel):
    section_id: Optional[int] = None
    question: str
    question_type: QuestionType
    options: Optional[List[dict]] = None
    correct_answer: Optional[Any] = None
    hint: Optional[str] = None
    is_final: bool = False  # –í–∫–ª—é—á–∞—Ç—å –≤ –∏—Ç–æ–≥–æ–≤—ã–π —Ç–µ—Å—Ç
    tags: Optional[List[str]] = None

class AddQuestionsToTestSchema(BaseModel):
    question_ids: List[int]
```

### 5.2 –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤

#### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤ –≤ `src/api/v1/questions/routes.py`:
```python
# –ù–æ–≤—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –¥–ª—è –±–∞–Ω–∫–∞ –≤–æ–ø—Ä–æ—Å–æ–≤
@router.get("/topics/{topic_id}/questions")
async def get_topic_questions(
    topic_id: int,
    is_final: Optional[bool] = None,
    session: AsyncSession = Depends(get_db),
    current_user=Depends(require_roles(Role.ADMIN, Role.TEACHER))
):
    return await QuestionService.get_topic_questions(
        session,
        topic_id,
        int(current_user["sub"]),
        is_final
    )

@router.post("/topics/{topic_id}/questions")
async def create_question_in_topic(
    topic_id: int,
    data: QuestionCreateInTopicSchema,
    session: AsyncSession = Depends(get_db),
    current_user=Depends(require_roles(Role.ADMIN, Role.TEACHER))
):
    return await QuestionService.create_question_in_topic(
        session,
        topic_id=topic_id,
        current_user_id=int(current_user["sub"]),
        **data.dict()
    )
```

#### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–≤—è–∑—è–º–∏ –≤ `src/api/v1/tests/routes.py`:
```python
@router.post("/{test_id}/questions")
async def add_questions_to_test(
    test_id: int,
    data: AddQuestionsToTestSchema,
    session: AsyncSession = Depends(get_db),
    current_user=Depends(require_roles(Role.ADMIN, Role.TEACHER))
):
    return await TestQuestionsService.add_questions_to_test(
        session,
        test_id,
        data.question_ids,
        int(current_user["sub"])
    )
```

---

## 6. –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ —ç—Ç–∞–ø–∞–º

### –≠—Ç–∞–ø 1: –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –ë–î ‚úÖ –ó–ê–í–ï–†–®–ï–ù (1 –¥–µ–Ω—å)
- [x] –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é Alembic –¥–ª—è –Ω–æ–≤—ã—Ö —Ç–∞–±–ª–∏—Ü –∏ –ø–æ–ª–µ–π
- [x] –î–æ–±–∞–≤–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É `test_questions`
- [x] –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—è `topic_id`, `section_id`, `created_by`, `is_final` –≤ `questions`
- [x] –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é: `alembic upgrade head`
- [x] ‚úÖ –ò—Ç–æ–≥–æ–≤—ã–π —Ç–µ—Å—Ç —Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ç–µ–º—ã (–ª–æ–≥–∏–∫–∞ –≤ TopicService)

### –≠—Ç–∞–ø 2: –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö ‚úÖ –ó–ê–í–ï–†–®–ï–ù (1 –¥–µ–Ω—å)
- [x] –û–±–Ω–æ–≤–∏—Ç—å `Question` –º–æ–¥–µ–ª—å –≤ `src/domain/models.py`
- [x] –î–æ–±–∞–≤–∏—Ç—å –º–æ–¥–µ–ª—å `TestQuestion`
- [x] –û–±–Ω–æ–≤–∏—Ç—å —Å–≤—è–∑–∏ –º–µ–∂–¥—É –º–æ–¥–µ–ª—è–º–∏
- [x] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏—é —Å—Ö–µ–º—ã: `alembic revision --autogenerate`

### –≠—Ç–∞–ø 3: –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ ‚úÖ –ó–ê–í–ï–†–®–ï–ù (2 –¥–Ω—è)
- [x] –°–æ–∑–¥–∞—Ç—å `src/repository/test_questions.py`
- [x] –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥—ã –≤ `src/repository/questions/crud.py`
- [x] ‚úÖ –ù–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–∞–Ω–∫–æ–º –≤–æ–ø—Ä–æ—Å–æ–≤ –ø–æ —Ç–µ–º–∞–º
- [x] ‚úÖ –ú–µ—Ç–æ–¥—ã –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –≤–æ–ø—Ä–æ—Å–æ–≤ —á–µ—Ä–µ–∑ test_questions JOIN
- [x] ‚úÖ –í—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –º–µ—Ç–æ–¥—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã
- [ ] –ù–∞–ø–∏—Å–∞—Ç—å –±–∞–∑–æ–≤—ã–µ unit —Ç–µ—Å—Ç—ã

### –≠—Ç–∞–ø 4: –°–µ—Ä–≤–∏—Å—ã ‚úÖ –ó–ê–í–ï–†–®–ï–ù (2 –¥–Ω—è)
- [x] –°–æ–∑–¥–∞—Ç—å `src/service/test_questions_service.py`
- [x] –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥—ã –≤ `QuestionService` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ç–µ–º–∞–º–∏
- [x] –î–æ–±–∞–≤–∏—Ç—å –∫–ª–∞—Å—Å `TestService` —Å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–º —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ–º –≤–æ–ø—Ä–æ—Å–æ–≤
- [x] ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∏—Ç–æ–≥–æ–≤–æ–≥–æ —Ç–µ—Å—Ç–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ç–µ–º—ã (TopicService.create_topic_service)
- [x] ‚úÖ –ó–∞–ø—Ä–µ—Ç–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º —Å–æ–∑–¥–∞–≤–∞—Ç—å –∏—Ç–æ–≥–æ–≤—ã–µ —Ç–µ—Å—Ç—ã (API guards)
- [x] ‚úÖ –õ–æ–≥–∏–∫–∞ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –≤–æ–ø—Ä–æ—Å–æ–≤ –ª–µ–∂–∏—Ç –≤ Python –∫–æ–¥–µ
- [ ] –ù–∞–ø–∏—Å–∞—Ç—å unit —Ç–µ—Å—Ç—ã —Å–µ—Ä–≤–∏—Å–æ–≤

### –≠—Ç–∞–ø 5: API ‚úÖ –ó–ê–í–ï–†–®–ï–ù (2 –¥–Ω—è)
- [x] ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –≤ `questions/create.py` (POST /topics/{topic_id})
- [x] ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –≤ `questions/read.py` (GET /topic/{topic_id})
- [x] ‚úÖ –î–æ–±–∞–≤–∏—Ç—å —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –≤ `questions/management/tests.py` (POST/DELETE /links/{test_id}/questions)
- [x] ‚úÖ –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–µ —Å—Ö–µ–º—ã –¥–ª—è –±–∞–Ω–∫–∞ –≤–æ–ø—Ä–æ—Å–æ–≤
- [x] ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∏—Ç–æ–≥–æ–≤–æ–≥–æ —Ç–µ—Å—Ç–∞ –≤ TopicService
- [x] ‚úÖ –ó–∞–ø—Ä–µ—Ç —Å–æ–∑–¥–∞–Ω–∏—è –∏—Ç–æ–≥–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- [x] ‚úÖ –ò—Å–ø—Ä–∞–≤–∏—Ç—å —ç–∫—Å–ø–æ—Ä—Ç—ã –≤ __init__.py —Ñ–∞–π–ª–∞—Ö
- [x] ‚úÖ –°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫ –∏–º–ø–æ—Ä—Ç–∞
- [ ] –ù–∞–ø–∏—Å–∞—Ç—å API —Ç–µ—Å—Ç—ã

### –≠—Ç–∞–ø 6: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Ñ–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è ‚úÖ –ó–ê–í–ï–†–®–ï–ù (3 –¥–Ω—è)
- [x] ‚úÖ –ù–∞–ø–∏—Å–∞—Ç—å unit —Ç–µ—Å—Ç—ã –¥–ª—è TestQuestionsService
- [x] ‚úÖ –ù–∞–ø–∏—Å–∞—Ç—å unit —Ç–µ—Å—Ç—ã –¥–ª—è –Ω–æ–≤—ã—Ö –º–µ—Ç–æ–¥–æ–≤ QuestionService
- [x] ‚úÖ –ù–∞–ø–∏—Å–∞—Ç—å unit —Ç–µ—Å—Ç—ã –¥–ª—è TestService (–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ)
- [x] ‚úÖ –ù–∞–ø–∏—Å–∞—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è API –±–∞–Ω–∫–∞ –≤–æ–ø—Ä–æ—Å–æ–≤
- [x] ‚úÖ –ù–∞–ø–∏—Å–∞—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è —Å–≤—è–∑–µ–π —Ç–µ—Å—Ç-–≤–æ–ø—Ä–æ—Å
- [x] ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª–Ω–æ–≥–æ —Ü–∏–∫–ª–∞: —Ç–µ–º–∞ ‚Üí —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç ‚Üí –≤–æ–ø—Ä–æ—Å—ã ‚Üí –ø–æ–ø—ã—Ç–∫–∞
- [x] ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è —Ñ–∏–Ω–∞–ª—å–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤
- [x] ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –∫ –±–∞–Ω–∫—É –≤–æ–ø—Ä–æ—Å–æ–≤
- [x] ‚úÖ –§–∏–∫—Å—Ç—É—Ä—ã –¥–ª—è —Ç–µ—Å—Ç–æ–≤ —Å–æ–∑–¥–∞–Ω—ã
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –Ω–æ–≤—ã—Ö API
- [ ] –§–∏–Ω–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

---

## 7. –†–∏—Å–∫–∏ –∏ mitigation

### 7.1 –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–∏—Å–∫–∏
- **–ù–æ–≤—ã–µ JOIN –∑–∞–ø—Ä–æ—Å—ã:** –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤, —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- **–ò–∑–º–µ–Ω–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π:** –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

### 7.2 –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ä–∏—Å–∫–∏
- **–†–µ–≥—Ä–µ—Å—Å–∏–∏:** –ü–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä unit –∏ integration —Ç–µ—Å—Ç–æ–≤

### 7.3 Mitigation —Å—Ç—Ä–∞—Ç–µ–≥–∏—è
- **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:** Unit —Ç–µ—Å—Ç—ã –Ω–∞ –∫–∞–∂–¥–æ–º —ç—Ç–∞–ø–µ
- **Code review:** –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π review –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π

---

## 8. –ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞

### ‚úÖ –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏
- –ú–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
- API —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ —Ä–µ–≥—Ä–µ—Å—Å–∏–π

### ‚úÖ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏
- –í–æ–ø—Ä–æ—Å—ã –º–æ–∂–Ω–æ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ —Ç–µ—Å—Ç–∞—Ö
- –ë–∞–Ω–∫ –≤–æ–ø—Ä–æ—Å–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- –ò—Ç–æ–≥–æ–≤—ã–µ —Ç–µ—Å—Ç—ã —Ñ–æ—Ä–º–∏—Ä—É—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏

---

## 9. Timeline –∏ —Å—Ç–∞—Ä—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### üìÖ –ü–ª–∞–Ω: 10 –¥–Ω–µ–π

| –î–µ–Ω—å | –ó–∞–¥–∞—á–∞ | –†–µ–∑—É–ª—å—Ç–∞—Ç |
|------|--------|-----------|
| 1 | –ë–î + –ú–æ–¥–µ–ª–∏ | –ú–∏–≥—Ä–∞—Ü–∏—è –≥–æ—Ç–æ–≤–∞, –º–æ–¥–µ–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã |
| 2-3 | –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ | –ù–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã |
| 4-5 | –°–µ—Ä–≤–∏—Å—ã | –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –≥–æ—Ç–æ–≤–∞ |
| 6-7 | API | –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç |
| 8-9 | –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ | –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç |
| 10 | –§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è | –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é |

### üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–°–µ–≥–æ–¥–Ω—è:** –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é Alembic –∏ –æ–±–Ω–æ–≤–∏—Ç—å –º–æ–¥–µ–ª–∏
2. **–ó–∞–≤—Ç—Ä–∞:** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –¥–ª—è –Ω–æ–≤—ã—Ö —Å–≤—è–∑–µ–π
3. **–ü–æ—Å–ª–µ–∑–∞–≤—Ç—Ä–∞:** –°–æ–∑–¥–∞—Ç—å —Å–µ—Ä–≤–∏—Å—ã –∏ API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
4. **–ß–µ—Ä–µ–∑ –Ω–µ–¥–µ–ª—é:** –ü–æ–ª–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–ù–∞—á–Ω–µ–º —Å –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î? üöÄ**

---

## üéØ **–ò–¢–û–ì–û–í–´–ô –°–¢–ê–¢–£–° –†–ï–ê–õ–ò–ó–ê–¶–ò–ò**

### ‚úÖ **–ó–ê–í–ï–†–®–ï–ù–ù–´–ï –≠–¢–ê–ü–´:**
- **–ë–î –∏ –º–æ–¥–µ–ª–∏:** –ü–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤—ã ‚úÖ
- **–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏:** –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ ‚úÖ
- **–°–µ—Ä–≤–∏—Å—ã:** –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –≥–æ—Ç–æ–≤–∞ ‚úÖ
- **API:** –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã —Å–æ–∑–¥–∞–Ω—ã ‚úÖ

### üîÑ **–¢–ï–ö–£–©–ï–ï –°–û–°–¢–û–Ø–ù–ò–ï:**
- **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –±–∞–Ω–∫–∞ –≤–æ–ø—Ä–æ—Å–æ–≤:** –ì–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ ‚úÖ
- **Many-to-many —Å–≤—è–∑–∏:** –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã ‚úÖ
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∏—Ç–æ–≥–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤:** –†–∞–±–æ—Ç–∞–µ—Ç ‚úÖ
- **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–æ–ø—Ä–æ—Å–æ–≤:** –õ–æ–≥–∏–∫–∞ –≤ –∫–æ–¥–µ ‚úÖ
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞:** –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã ‚úÖ

### üìã **–û–°–¢–ê–õ–û–°–¨ –°–î–ï–õ–ê–¢–¨:**
- **Unit —Ç–µ—Å—Ç—ã:** –ù–∞–ø–∏—Å–∞—Ç—å –¥–ª—è –Ω–æ–≤—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- **API —Ç–µ—Å—Ç—ã:** –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å—é —Ü–µ–ø–æ—á–∫—É
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** –û–±–Ω–æ–≤–∏—Ç—å OpenAPI

### üî• **–ì–û–¢–û–í–ù–û–°–¢–¨ –ö –†–ê–ë–û–¢–ï:**
**–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –±–∞–Ω–∫–∞ –≤–æ–ø—Ä–æ—Å–æ–≤ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é! üöÄ**

**–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:**
1. –ù–∞–ø–∏—Å–∞—Ç—å –±–∞–∑–æ–≤—ã–µ unit —Ç–µ—Å—Ç—ã
2. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–º
4. –ù–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É –Ω–∞–¥ –ø–æ–ø—ã—Ç–∫–∞–º–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
